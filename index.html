<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantum Qtum QR Scanner</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
    color: #e0f2fe;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    text-align: center;
  }

  h1 {
    margin-top: 10px;
    margin-bottom: 6px;
    font-size: 26px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #38bdf8;
    text-shadow: 0 0 16px #0ea5e9;
  }

  h2 {
    margin-top: 0;
    font-size: 13px;
    font-weight: 500;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.18em;
  }

  #quantumLogo {
    width: 120px;
    margin: 10px auto 18px;
    filter: drop-shadow(0 0 14px #22d3ee);
    display: block;
  }

  #scannerShell {
    max-width: 420px;
    margin: 0 auto;
    padding: 14px 14px 18px;
    border-radius: 18px;
    background: linear-gradient(145deg, #020617 0, #020617 40%, #0b1120 100%);
    box-shadow:
      0 0 30px rgba(56, 189, 248, 0.25),
      0 0 80px rgba(59, 130, 246, 0.18);
    border: 1px solid rgba(59, 130, 246, 0.45);
  }

  #video {
    width: 100%;
    border-radius: 14px;
    border: 1px solid rgba(56, 189, 248, 0.7);
    background: #000;
    box-shadow: 0 0 22px rgba(56, 189, 248, 0.35);
  }

  #overlayFrame {
    position: relative;
    margin-top: -100%;
    width: 100%;
    height: 0;
    padding-bottom: 100%;
    pointer-events: none;
  }

  #overlayFrame::before {
    content: "";
    position: absolute;
    inset: 18%;
    border-radius: 18px;
    border: 2px dashed rgba(56, 189, 248, 0.8);
    box-shadow: 0 0 18px rgba(56, 189, 248, 0.6);
  }

  #controls {
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
  }

  button {
    border: none;
    border-radius: 999px;
    padding: 9px 16px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    background: linear-gradient(135deg, #1d4ed8, #22d3ee);
    color: #e0f2fe;
    box-shadow: 0 0 14px rgba(56, 189, 248, 0.7);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  button.secondary {
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(148, 163, 184, 0.6);
    box-shadow: none;
    color: #cbd5f5;
  }

  button:active {
    transform: scale(0.97);
  }

  #output {
    margin-top: 16px;
    padding: 12px 12px 10px;
    border-radius: 12px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(51, 65, 85, 0.9);
    text-align: left;
    font-size: 13px;
  }

  #status {
    font-weight: 500;
    margin-bottom: 6px;
  }

  #status.valid {
    color: #4ade80;
  }

  #status.invalid {
    color: #f97373;
  }

  #status.neutral {
    color: #e0f2fe;
  }

  #payloadLabel {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.16em;
    color: #64748b;
    margin-bottom: 2px;
  }

  #payload {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 12px;
    word-break: break-all;
    color: #7dd3fc;
  }

  #hint {
    margin-top: 8px;
    font-size: 11px;
    color: #64748b;
  }

  #qtumTag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    font-size: 11px;
    color: #a5b4fc;
    text-transform: uppercase;
    letter-spacing: 0.16em;
  }

  #qtumDot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 30%, #f9a8d4, #22d3ee);
    box-shadow: 0 0 10px rgba(244, 114, 182, 0.9);
  }

  #fileInput {
    display: none;
  }
</style>
</head>
<body>

<svg id="quantumLogo" viewBox="0 0 200 200">
  <defs>
    <radialGradient id="ringGlow" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#22d3ee"/>
      <stop offset="45%" stop-color="#0ea5e9"/>
      <stop offset="100%" stop-color="#1d4ed8"/>
    </radialGradient>
  </defs>
  <circle cx="100" cy="100" r="70" stroke="url(#ringGlow)" stroke-width="6" fill="none"/>
  <circle cx="100" cy="100" r="40" stroke="#22d3ee" stroke-width="3" fill="none"/>
  <text x="100" y="115" font-size="48" text-anchor="middle" fill="#e0f2fe">Q</text>
  <polygon points="70,40 100,10 130,40" fill="#f9a8d4"/>
</svg>

<h1>Quantum Qtum Scanner</h1>
<h2>Cosmic QR reader for Qtum & beyond</h2>

<div id="scannerShell">
  <video id="video" autoplay playsinline muted></video>
  <div id="overlayFrame"></div>
  <canvas id="canvas" hidden></canvas>

  <div id="controls">
    <button id="startBtn">
      <span>üîÆ Enable Camera</span>
    </button>
    <button id="flipBtn" class="secondary">
      <span>üîÅ Flip Camera</span>
    </button>
    <button id="uploadBtn" class="secondary">
      <span>üìÅ Scan Image</span>
    </button>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <div id="output">
    <div id="status" class="neutral">Point your camera at a QR code‚Ä¶</div>
    <div id="payloadLabel">Decoded data</div>
    <div id="payload"></div>
    <div id="hint">Works with any QR code. Qtum addresses are highlighted when detected.</div>
    <div id="qtumTag">
      <div id="qtumDot"></div>
      <span>Qtum aware</span>
    </div>
  </div>
</div>

<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const statusEl = document.getElementById("status");
  const payloadEl = document.getElementById("payload");
  const startBtn = document.getElementById("startBtn");
  const flipBtn = document.getElementById("flipBtn");
  const uploadBtn = document.getElementById("uploadBtn");
  const fileInput = document.getElementById("fileInput");

  let currentStream = null;
  let useFrontCamera = false;
  let scanning = false;

  function isQtumAddress(text) {
    return /^Q[0-9A-Za-z]{25,40}$/.test(text.trim());
  }

  async function stopCamera() {
    if (currentStream) {
      currentStream.getTracks().forEach(t => t.stop());
      currentStream = null;
    }
    scanning = false;
  }

  async function startCamera() {
    await stopCamera();
    statusEl.textContent = "Requesting camera access‚Ä¶";
    statusEl.className = "neutral";

    const constraints = {
      video: {
        facingMode: useFrontCamera ? { ideal: "user" } : { ideal: "environment" }
      }
    };

    try {
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      currentStream = stream;
      video.srcObject = stream;
      scanning = true;
      statusEl.textContent = "Camera active. Aim at a QR code.";
      statusEl.className = "neutral";
      requestAnimationFrame(scanLoop);
    } catch (err) {
      console.error("Camera error:", err);
      statusEl.textContent = "Camera error: " + err.message;
      statusEl.className = "invalid";
    }
  }

  function scanLoop() {
    if (!scanning || !video.videoWidth || !video.videoHeight) {
      if (scanning) requestAnimationFrame(scanLoop);
      return;
    }

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const code = jsQR(img.data, img.width, img.height, { inversionAttempts: "dontInvert" });

    if (code && code.data) {
      const text = code.data.trim();
      payloadEl.textContent = text;

      if (isQtumAddress(text)) {
        statusEl.textContent = "Qtum address detected.";
        statusEl.className = "valid";
      } else {
        statusEl.textContent = "QR code detected.";
        statusEl.className = "neutral";
      }
    }

    if (scanning) requestAnimationFrame(scanLoop);
  }

  // Image upload scanning
  uploadBtn.onclick = () => fileInput.click();

  fileInput.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(data.data, data.width, data.height, { inversionAttempts: "dontInvert" });

      if (code && code.data) {
        const text = code.data.trim();
        payloadEl.textContent = text;

        if (isQtumAddress(text)) {
          statusEl.textContent = "Qtum address detected (from image).";
          statusEl.className = "valid";
        } else {
          statusEl.textContent = "QR code detected (from image).";
          statusEl.className = "neutral";
        }
      } else {
        statusEl.textContent = "No QR code found in image.";
        statusEl.className = "invalid";
      }
    };
    img.onerror = () => {
      statusEl.textContent = "Could not read image.";
      statusEl.className = "invalid";
    };
    img.src = URL.createObjectURL(file);
  };

  startBtn.onclick = () => {
    startCamera();
  };

  flipBtn.onclick = async () => {
    useFrontCamera = !useFrontCamera;
    if (currentStream) {
      await startCamera();
    }
  };
</script>

</body>
</html>
